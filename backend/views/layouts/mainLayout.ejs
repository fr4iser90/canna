<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/sites/styles/global.css">
    <link rel="stylesheet" href="/sites/styles/navigation.css">
    <script src="/sites/scripts/global.js" defer type="module"></script>
    <script src="/sites/scripts/auth/logout.js" defer type="module"></script>  
</head>
<body>
    <%- include('../partials/header') %>
    <div class="main-content">
        <%- body %>
    </div>
    <%- include('../partials/footer') %>

    <script type="module" nonce="<%= nonce %>">
        import { getCookies, getUserId, getToken, checkTokenAndRedirect, checkUserRole } from '/sites/scripts/global.js';

        document.addEventListener('DOMContentLoaded', async () => {
            const cookies = getCookies();
            const authData = cookies.authData ? JSON.parse(decodeURIComponent(cookies.authData)) : null;
            const userId = getUserId();
            const token = getToken();
            await checkUserRole();
            await checkTokenAndRedirect();
        });
    </script>
</body>
</html>
